extends ../layout-dashboard

block pageMeta
  //- Page title
  - const pageTitle = 'Mi cuenta'
  //- Set the current pages
  - const section = "my-account"
  - const current = "account-data"

block content

  //- To translate currency codes to natural names
  - const currencyInLocale = new Intl.DisplayNames(['es-CL'], { type: 'currency' });

  #dashboard__panel__wrapper.container-xxl
    .row.px-sm-4.py-4

      //- Update user profile
      section.dashboard__panel.col-lg-6
        .card.mb-4.border-0.shadow-lg
          .card-header.p-4.pb-0
            h2.mb-4 Datos de mi cuenta
    
          .card-body.p-4
            form(action="/mi-cuenta", method="post") 

              .row.mb-3
                .col-sm-4.mb-1
                  label(for="firstName") Nombre&thinsp;*
                .col-sm-8
                  input.form-control(type="text", name="firstName", value=user.firstName, required)
                  if errors.firstName
                    .text-danger.mt-2 
                      small #{errors.firstName}

              .row.mb-3
                .col-sm-4.mb-1 
                  label(for="lastName") Apellido 
                .col-sm-8
                  input.form-control(type="text", name="lastName", value=user.lastName)
                  if errors.lastName 
                    .text-danger.mt-2 
                      small #{errors.lastName}
            
              .row.mb-3
                .col-sm-4.mb-1 
                  label(for="email") Correo&thinsp;*
                .col-sm-8
                  input.form-control(type="text", name="email", value=user.email, required)
                  if errors.email 
                    .text-danger.mt-2 
                      small #{errors.email}
              
              .row.mb-3
                .col-sm-4.mb-1 
                  label(for="preferredLocale") Idioma de preferencia&thinsp;*
                .col-sm-8
                  select.form-select(name="preferredLocale", required=true)
                    - for (const lang in langmap)
                      if lang === user.preferredLocale 
                        option(value=lang, selected) #{langmap[lang]['nativeName']}
                      else 
                        option(value=lang) #{langmap[lang]['nativeName']}
                  if errors.preferredLocale 
                    .text-danger.mt-2 
                      small #{errors.preferredLocale}
              
              //- TODO: Keep readonly until list could had different currencies that the user default,
              //- so when a user changes its default currency, all list that default to user's
              //- previous default are setted explicitly to that currency.
              .row.mb-3
                .col-sm-4.mb-1 
                  label(for="defaultCurrency") Moneda&thinsp;
                .col-sm-8
                  p #{user.defaultCurrency} &ndash; #{currencyInLocale.of(user.defaultCurrency)}
                  //- select.form-select(name="defaultCurrency", required=true)
                  //-   each currency in currencies
                  //-     if currency.code === user.defaultCurrency
                  //-       option(value=currency.code, selected) #{currency.code} &ndash; #{currencyInLocale.of(currency.code)}
                  //-     else 
                  //-       option(value=currency.code) #{currency.code} &ndash; #{currencyInLocale.of(currency.code)}
                  //- if errors.defaultCurrency 
                  //-   .text-danger.mt-2 
                  //-     small #{errors.defaultCurrency}
              div 
                button.btn.btn-primary.text-light(type="submit", name="fromForm", value="updateUser") Actualizar datos

      //- Update password
      section.dashboard__panel.col-lg-6
        .card.mb-4.border-0.shadow-lg
          .card-header.p-4.pb-0
            h2.mb-4 Cambiar contraseña
        
          .card-body.p-4
            if success 
              p ¡Contraseña actualizada!
            form(action="/mi-cuenta", method="post")

              .row.mb-3 
                .col-sm-6.mb-1
                  label(for="currentPassword") Contraseña actual&thinsp;*
                .col-sm-6
                  input(type="password", name="currentPassword", required=true, class="form-control")
                  if errors.currentPassword 
                    .text-danger.mt-2
                      small #{errors.currentPassword}
              
              .row.mb-3 
                .col-sm-6.mb-1
                  label(for="newPassword") Nueva contraseña&thinsp;*
                .col-sm-6
                  input(type="password", name="newPassword", required=true, class="form-control")
                  if errors.newPassword 
                    .text-danger.mt-2
                      small #{errors.newPassword}

              .row.mb-3
                .col-sm-6.mb-1
                  label(for="passwordConfirmation") Repita la contraseña&thinsp;*
                .col-sm-6 
                  input(type="password", name="passwordConfirmation", required=true, class="form-control")
                  if errors.passwordConfirmation 
                    .text-danger.mt-2
                      small #{errors.passwordConfirmation}
              div 
                button.btn.btn-primary.text-light(type="submit", name="fromForm", value="updatePassword", class="btn btn-primary") Actualizar contraseña